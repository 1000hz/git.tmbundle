<html>
<head>
  <title><%= @header %></title>
  <link type="text/css" rel="stylesheet" media="screen" href="<%= resource_url('style.css') %>"/>
</head>
<body id='body'>
  <% yield %>
</body>
<!-- we put the script at the end because it messes up TextMate's html rendering, for some reason -->
<%= javascript_include_tag "prototype", "rb_gateway" %>
<script language='JavaScript'>
  function show_annotation(revision)
  {
    $('content').update(gateway_command('annotate.rb', [revision]));
  }
  
  function keypress_listener(e) 
  {
    // if (e.keyCode==Event.KEY_LEFT)
    //   $('debug').update('escape!!!');
    // else
    //   $('debug').update(e.keyCode)
      
    switch(e.keyCode) {
      case 110: // n
        if ($('rev').selectedIndex >= 1)
        {
          $('rev').selectedIndex = $('rev').selectedIndex - 1
          $('rev').onchange();
        }
        break;
      case 112: // p
        if ($('rev').selectedIndex < $('rev').options.length - 1)
        {
          $('rev').selectedIndex = $('rev').selectedIndex + 1
          $('rev').onchange();
        }
        break;
      case 78: // P
        $('rev').selectedIndex = 0;
        $('rev').onchange();
        break;
      case 80: // N
        $('rev').selectedIndex = $('rev').options.length - 1;
        $('rev').onchange();
        break;
      case 98: // b
        gateway_command('create_branch_from_revision.rb', [$F('rev')] )
      case 111: // o
        gateway_command('show.rb', ["<%=e_js ENV['TM_FILEPATH'] %>", $F('rev')] )
        // 
        break;
    }
    $('debug').update(e.keyCode);
  }
  
  try {
    Event.observe(document, "keypress", keypress_listener.bindAsEventListener());
  }
  catch (e) {
    $('debug').update(e)
  }
</script>
</html>